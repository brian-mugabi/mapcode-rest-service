<!--
  ~ Copyright (C) 2015 Stichting Mapcode Foundation (http://www.mapcode.com)
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<html>
<body>
<h1>Sample HTML/Javascript using the mapcode REST API</h1>

<!--
 ~ --------------------------------------------------------------------------------
 ~ UTILITY FUNCTIONS
 ~ --------------------------------------------------------------------------------
-->

<script type="text/javascript">

    /* This is the base URL of the mapcode REST API. */
    var apiBaseURL = "http://mapcode.buve.info/mapcode";
    // var apiBaseURL = "http://localhost:8080/mapcode";

    function createResponseLine(status, result) {
        return "<font color=\"#22aa22\"><small>" + ((status == 200) ? "" : "<font color=\"cc2222\">") +
                "<b>Response:</b><br><tt>" + result + "</tt>" +
                ((status == 200) ? "" : "</font>") + "</small></font><br/><br/>";
    }

    function createRequestLine(request) {
        return "<font color=\"#22aa22\"><small><b>Request:</b><br><tt>HTTP GET " + request + "</tt></small></font><br/><br/>";

    }

    function createTerritoryLine(territory) {
        var line = "<b>" + territory.territoryIso + "</b> (" + territory.territoryCode + ") - <u>" + territory.fullname + "</u>";
        if (territory.aliases) {
            line += ", also known as: ";
            for (j = 0; j < territory.aliases.length; j++) {
                line += territory.aliases[j] + ' ';
            }
        }
        return line;
    }
</script>

<!--
 ~ --------------------------------------------------------------------------------
 ~ ENCODE LAT/LON TO MAPCODE
 ~ --------------------------------------------------------------------------------
-->

<script type="text/javascript">
    function encodeButtonPressed() {
        document.getElementById("resultEncode").innerHTML = '<font color=grey>Waiting...</font>';

        /* Use the input fields to build the request URL. */
        var territory = document.getElementById("territoryEncode").value;
        var lat = document.getElementById("lat").value;
        var lon = document.getElementById("lon").value;
        var url = apiBaseURL + "/codes/" + lat + "," + lon + "?precision=0&include=territory" +
                ((territory && (territory.length != 0)) ? "&territory=" + territory : "");
        document.getElementById("requestEncode").innerHTML = createRequestLine(url);

        /* Asynchronously request a solution, call encodeResponseReady when done. */
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4) {
                encodeResponseReady(xmlhttp.responseText, xmlhttp.status);
            }
        }
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }

    function encodeResponseReady(response, status) {

        /* Did the request succeed? */
        document.getElementById("responseEncode").innerHTML = createResponseLine(status, response);
        if ((status == 200) && response) {

            /* Parse the response into an array of mapcodes. */
            var result = JSON.parse(response);

            /* Print the mapcodes, grey them if they are not the shortest (i.e. the first) in a territory. */
            var resultLines = "<b><u>There are " + result.mapcodes.length + " possible mapcodes:</b></u><br><tt>";
            for (i = 0; i < result.mapcodes.length; i++) {
                var isGrey = ((i > 0) && (result.mapcodes[i].territory == result.mapcodes[i - 1].territory));
                if (isGrey) {
                    resultLines += "<font color=\"#bbbbbb\">";
                }
                resultLines += ((result.mapcodes[i].territory == "AAA") ? "" : result.mapcodes[i].territory) +
                        " <b>" + result.mapcodes[i].mapcode + "</b>";
                if (result.mapcodes[i].mapcode == result.local.mapcode) {
                    resultLines += " (default local)";
                }
                if (result.mapcodes[i].territory == "AAA") {
                    resultLines += " (international)";
                }
                if (isGrey) {
                    resultLines += "</font>";
                }
                resultLines += "<br/>"
            }
            resultLines += "</tt>"
            document.getElementById("resultEncode").innerHTML = resultLines;
        }
        else {
            document.getElementById("resultEncode").innerHTML = "<b>Error</b> (status = " + status + ')';
        }
    }
</script>

<h2>Convert latitude/longitude to mapcode</h2>

<p>
    <tt>HTTP GET /mapcode/codes/{lat},{lon}[?territory={restrictToTerritory}]</tt>
</p>

<form action="#" onsubmit="return encodeButtonPressed();">
    <input type="text" id="lat" value="51.427624"> = latitude [-90, 90] (must be in range)
    <br/>
    <input type="text" id="lon" value="5.488075"> = longitude [-180, 180] (wrapped if outside of range)
    <br/>
    <input type="text" id="territoryEncode" value=""> = restrict results to 1 territory (empty = no restriction)
    <br/>
    <input type="button" value="Encode" onclick="encodeButtonPressed()">
</form>

<div id="resultEncode"></div>
<br/>

<div id="requestEncode"></div>
<div id="responseEncode"></div>

<hr/>

<!--
 ~ --------------------------------------------------------------------------------
 ~ DECODE MAPCODE TO LAT/LON
 ~ --------------------------------------------------------------------------------
-->

<script type="text/javascript">
    function decodeButtonPressed() {

        /* Use the input fields to build the request URL. */
        var context = document.getElementById("contextDecode").value;
        if (context == "") {
            context = "AAA";
        }
        var mapcode = document.getElementById("mapcode").value;
        var url = apiBaseURL + "/coords/" + mapcode + "?context=" + context;

        /* Update page. */
        document.getElementById("resultDecode").innerHTML = '<font color=grey>Waiting...</font>';
        document.getElementById("requestDecode").innerHTML = createRequestLine(url);

        /* Asynchronously request to decode mapcode, call decodeResponseReady when done. */
        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
            if (request.readyState == 4) {
                decodeResponseReady(request.responseText, request.status);
            }
        }
        request.open("GET", url, true);
        request.send();
    }

    function decodeResponseReady(response, status) {

        /* Did the request succeed? */
        document.getElementById("responseDecode").innerHTML = createResponseLine(status, response);
        if ((status == 200) && response) {

            /* Parse the response into a coordinate. */
            var result = JSON.parse(response);
            document.getElementById("resultDecode").innerHTML = "<b><u>Coordinate:</u></b><br><tt>(" + result.latDeg + ", " + result.lonDeg + ")</tt>";
        }
        else {
            document.getElementById("resultDecode").innerHTML = "<b>Error</b> (status = " + status + ')';
        }
    }
</script>

<h2>Convert mapcode to latitude/longitude</h2>

<p>
    <tt>HTTP GET /mapcode/coords/{mapcode}[?context={territoryContext}]</tt>
</p>

<form action="#" onsubmit="return decodeButtonPressed();">
    <input type="text" id="contextDecode" value="NLD"> = mapcode territory (empty = international)
    <br/>
    <input type="text" id="mapcode" value="XX.XX"> = mapcode code
    <br/>
    <input type="button" value="Decode" onclick="decodeButtonPressed()">
</form>

<div id="resultDecode"></div>
<br/>

<div id="requestDecode"></div>
<div id="responseDecode"></div>

<hr>

<!--
 ~ --------------------------------------------------------------------------------
 ~ TERRITORY INFORMATION
 ~ --------------------------------------------------------------------------------
-->

<script>
    function territoryButtonPressed() {
        document.getElementById("resultTerritory").innerHTML = '<font color=grey>Waiting...</font>';

        var territory = document.getElementById("territory").value;
        var context = document.getElementById("context").value;
        var url = apiBaseURL + "/territories" + (territory ? ('/' + territory) : "") + (context ? ("?context=" + context) : "");
        document.getElementById("requestTerritory").innerHTML = createRequestLine(url);

        /* Asynchronously request a solution, call encodeResponseReady when done. */
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4) {
                territoryResponseReady(xmlhttp.responseText, xmlhttp.status);
            }
        }
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }

    function territoryResponseReady(response, status) {

        /* Did the request succeed? */
        document.getElementById("responseTerritory").innerHTML = createResponseLine(status, response);
        if ((status == 200) && response) {

            /* Parse the response into an array of mapcodes. */
            var result = JSON.parse(response);

            var resultLines = "";
            if (result.territories) {
                resultLines += "<b><u>List all territories (" + result.territories.length + "):</u></b></u><br/><small>";
                for (i = 0; i < result.territories.length; i++) {
                    var territory = result.territories[i];
                    resultLines += createTerritoryLine(territory) + "<br/>";
                }
            }
            else {
                resultLines += "<b><u>List one territory:</u></b></u><br/><small>";
                resultLines += createTerritoryLine(result);
            }
            resultLines += "<small>"
            document.getElementById("resultTerritory").innerHTML = resultLines;
        }
        else {
            document.getElementById("resultTerritory").innerHTML = "<b>Error</b> (status = " + status + ')';
        }
    }
</script>

<h2>Get territory information</h2>

<p>
    <tt>HTTP GET /mapcode/territory[/{territory}[?context={territoryContext}]]</tt>
</p>

<form action="#" onsubmit="return decodeButtonPressed();">
    <input type="text" id="territory" value=""> = territory to show info for (empty = all territories)
    <br/>
    <input type="text" id="context" value=""> = territory context (optional, for disambiguation)
    <br/>
    <input type="button" value="List" onclick="territoryButtonPressed()">
</form>

<div id="resultTerritory"></div>
<br/>

<div id="requestTerritory"></div>
<div id="responseTerritory"></div>

</body>
</html>
